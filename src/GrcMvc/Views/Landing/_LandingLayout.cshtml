@using GrcMvc.Services
@using GrcMvc.Services.Interfaces
@inject IAppInfoService AppInfo
@inject ISiteSettingsService SiteSettings
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor
@{
    var baseUrl = $"{HttpContextAccessor.HttpContext?.Request.Scheme}://{HttpContextAccessor.HttpContext?.Request.Host}";
    var currentPath = HttpContextAccessor.HttpContext?.Request.Path.ToString() ?? "/";
    var canonicalUrl = $"{baseUrl}{currentPath}";
    var metaDescription = ViewData["MetaDescription"]?.ToString() ?? "منصة شاهين - نظام متكامل لإدارة الحوكمة والمخاطر والامتثال";
    var ogImage = ViewData["OgImage"]?.ToString() ?? $"{baseUrl}/images/og-image.png";
}
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="@metaDescription" />
    <meta name="keywords" content="GRC, حوكمة, مخاطر, امتثال, السعودية, شاهين" />
    <title>@ViewData["Title"] - @AppInfo.Name</title>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="~/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="~/images/brand/favicon-32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="~/images/brand/favicon-16.png" />
    <link rel="apple-touch-icon" sizes="128x128" href="~/images/brand/favicon-128.png" />
    <meta name="application-name" content="@AppInfo.Name" />
    <meta name="author" content="@AppInfo.CompanyName" />

    <!-- Canonical URL -->
    <link rel="canonical" href="@canonicalUrl" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="~/css/landing.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/tailwind.output.css" asp-append-version="true" />

    <!-- Open Graph / Social Meta Tags -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="@canonicalUrl" />
    <meta property="og:title" content="@ViewData["Title"] - @AppInfo.Name" />
    <meta property="og:description" content="@metaDescription" />
    <meta property="og:image" content="@ogImage" />
    <meta property="og:locale" content="ar_SA" />
    <meta property="og:locale:alternate" content="en_US" />
    <meta property="og:site_name" content="@AppInfo.Name" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="@ViewData["Title"] - @AppInfo.Name" />
    <meta name="twitter:description" content="@metaDescription" />
    <meta name="twitter:image" content="@ogImage" />

    <!-- Structured Data (JSON-LD) for SEO -->
    <script type="application/ld+json">
    {
        "@@context": "https://schema.org",
        "@@type": "SoftwareApplication",
        "name": "@AppInfo.Name",
        "alternateName": "Shahin GRC",
        "description": "@metaDescription",
        "applicationCategory": "BusinessApplication",
        "operatingSystem": "Web Browser",
        "url": "@baseUrl",
        "offers": {
            "@@type": "Offer",
            "price": "0",
            "priceCurrency": "SAR",
            "description": "7-day free trial with full access"
        },
        "aggregateRating": {
            "@@type": "AggregateRating",
            "ratingValue": "4.9",
            "ratingCount": "127"
        },
        "provider": {
            "@@type": "Organization",
            "name": "@AppInfo.CompanyName",
            "url": "https://www.doganconsult.com",
            "logo": "@baseUrl/images/brand/logo.png",
            "sameAs": [
                "@SiteSettings.LinkedInUrl",
                "@SiteSettings.TwitterUrl"
            ],
            "address": {
                "@@type": "PostalAddress",
                "addressCountry": "SA",
                "addressLocality": "Riyadh"
            }
        },
        "featureList": [
            "Smart Compliance Scope Derivation",
            "130+ KSA & International Regulators",
            "400+ Controls Library",
            "AI-Powered Risk Assessment",
            "Evidence Management",
            "Automated Workflows",
            "Multi-tenant Architecture",
            "Arabic & English Support"
        ]
    }
    </script>

    <!-- Organization Schema -->
    <script type="application/ld+json">
    {
        "@@context": "https://schema.org",
        "@@type": "Organization",
        "name": "@AppInfo.CompanyName",
        "url": "https://www.doganconsult.com",
        "logo": "@baseUrl/images/brand/logo.png",
        "description": "Dogan Consult - Technology & Consulting Services",
        "foundingDate": "2020",
        "sameAs": [
            "@SiteSettings.LinkedInUrl",
            "@SiteSettings.TwitterUrl",
            "@SiteSettings.YouTubeUrl"
        ],
        "contactPoint": {
            "@@type": "ContactPoint",
            "telephone": "@SiteSettings.PhoneNumber",
            "contactType": "customer service",
            "availableLanguage": ["Arabic", "English"]
        }
    }
    </script>

    @await RenderSectionAsync("Styles", required: false)
</head>
<body>
    <!-- Skip Link for Accessibility -->
    <a href="#main-content" class="skip-link">تخطي إلى المحتوى الرئيسي</a>

    <!-- Navigation -->
    <nav class="landing-navbar" role="navigation" aria-label="التنقل الرئيسي">
        <div class="container">
            <div class="navbar-inner">
                <a href="/" class="navbar-brand" aria-label="الرئيسية - شاهين">
                    <img src="~/images/brand/eagle-logo.svg" alt="شاهين" class="logo-icon-img" style="width: 40px; height: 40px;" aria-hidden="true" />
                    <span>شاهين</span>
                </a>

                <!-- Desktop Navigation -->
                <div class="nav-links" role="menubar">
                    <a href="/features" class="nav-link @(ViewData["Title"]?.ToString()?.Contains("المميزات") == true ? "active" : "")" role="menuitem">المميزات</a>
                    <a href="/pricing" class="nav-link @(ViewData["Title"]?.ToString()?.Contains("الأسعار") == true ? "active" : "")" role="menuitem">الأسعار</a>
                    <a href="/about" class="nav-link @(ViewData["Title"]?.ToString()?.Contains("من نحن") == true ? "active" : "")" role="menuitem">عن المنصة</a>
                    <a href="/contact" class="nav-link @(ViewData["Title"]?.ToString()?.Contains("تواصل") == true ? "active" : "")" role="menuitem">تواصل معنا</a>
                </div>

                <div class="nav-actions">
                    <!-- Theme Toggle -->
                    <button class="theme-toggle" onclick="toggleTheme()" aria-label="تبديل المظهر" title="تبديل المظهر">
                        <i class="bi bi-sun-fill theme-icon-light" aria-hidden="true"></i>
                        <i class="bi bi-moon-fill theme-icon-dark" aria-hidden="true"></i>
                    </button>

                    <!-- Desktop Buttons -->
                    <a href="/Account/Login" class="btn btn-outline d-none d-md-inline-flex">
                        <i class="bi bi-person-circle" aria-hidden="true"></i>
                        تسجيل الدخول
                    </a>
                    <a href="/account/register" class="btn btn-outline d-none d-md-inline-flex">
                        <i class="bi bi-person-plus" aria-hidden="true"></i>
                        إنشاء حساب
                    </a>
                    <a href="/trial" class="btn btn-primary d-none d-md-inline-flex">
                        <i class="bi bi-rocket-takeoff-fill" aria-hidden="true"></i>
                        ابدأ مجاناً
                    </a>

                    <!-- Mobile Menu Toggle -->
                    <button class="mobile-menu-toggle"
                            onclick="toggleMobileMenu()"
                            aria-label="فتح القائمة"
                            aria-expanded="false"
                            aria-controls="mobile-menu">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Mobile Menu -->
    <div id="mobile-menu" class="mobile-menu" role="menu" aria-hidden="true">
        <a href="/features" class="nav-link" role="menuitem">المميزات</a>
        <a href="/pricing" class="nav-link" role="menuitem">الأسعار</a>
        <a href="/about" class="nav-link" role="menuitem">عن المنصة</a>
        <a href="/contact" class="nav-link" role="menuitem">تواصل معنا</a>
        <a href="/faq" class="nav-link" role="menuitem">الأسئلة الشائعة</a>
        <div class="nav-actions">
            <a href="/Account/Login" class="btn btn-outline">
                <i class="bi bi-person-circle" aria-hidden="true"></i>
                تسجيل الدخول
            </a>
            <a href="/account/register" class="btn btn-outline">
                <i class="bi bi-person-plus" aria-hidden="true"></i>
                إنشاء حساب
            </a>
            <a href="/trial" class="btn btn-primary">
                <i class="bi bi-rocket-takeoff-fill" aria-hidden="true"></i>
                ابدأ مجاناً
            </a>
        </div>
    </div>

    <!-- Main Content -->
    <main id="main-content" role="main">
        @RenderBody()
    </main>

    <!-- Footer -->
    <footer class="landing-footer" role="contentinfo">
        <div class="container">
            <div class="footer-grid">
                <div>
                    <div class="footer-brand">
                        <div class="logo-icon" aria-hidden="true">ش</div>
                        <span class="footer-brand-text">شاهين</span>
                    </div>
                    <p class="footer-desc">
                        منصة متكاملة لإدارة الحوكمة والمخاطر والامتثال.
                        مصممة للمملكة العربية السعودية والعالم.
                    </p>
                    <div class="footer-social">
                        @if (SiteSettings.HasLinkedIn)
                        {
                            <a href="@SiteSettings.LinkedInUrl" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn">
                                <i class="bi bi-linkedin" aria-hidden="true"></i>
                            </a>
                        }
                        @if (SiteSettings.HasTwitter)
                        {
                            <a href="@SiteSettings.TwitterUrl" target="_blank" rel="noopener noreferrer" aria-label="Twitter">
                                <i class="bi bi-twitter-x" aria-hidden="true"></i>
                            </a>
                        }
                        @if (SiteSettings.HasYouTube)
                        {
                            <a href="@SiteSettings.YouTubeUrl" target="_blank" rel="noopener noreferrer" aria-label="YouTube">
                                <i class="bi bi-youtube" aria-hidden="true"></i>
                            </a>
                        }
                    </div>
                </div>
                <div>
                    <h2 class="footer-title">المنتج</h2>
                    <ul class="footer-links">
                        <li><a href="/features">المميزات</a></li>
                        <li><a href="/trial">التجربة المجانية</a></li>
                        <li><a href="/account/register">إنشاء حساب</a></li>
                        <li><a href="/pricing">الأسعار</a></li>
                    </ul>
                </div>
                <div>
                    <h2 class="footer-title">الموارد</h2>
                    <ul class="footer-links">
                        <li><a href="/docs">التوثيق</a></li>
                        <li><a href="/blog">المدونة</a></li>
                        <li><a href="/webinars">الندوات</a></li>
                        <li><a href="/case-studies">دراسات الحالة</a></li>
                    </ul>
                </div>
                <div>
                    <h2 class="footer-title">الشركة</h2>
                    <ul class="footer-links">
                        <li><a href="/about">من نحن</a></li>
                        <li><a href="/contact">تواصل معنا</a></li>
                        <li><a href="/careers">الوظائف</a></li>
                        <li><a href="/partners">الشركاء</a></li>
                    </ul>
                </div>
                <div>
                    <h2 class="footer-title">الدعم</h2>
                    <ul class="footer-links">
                        <li><a href="/help">مركز المساعدة</a></li>
                        <li><a href="/faq">الأسئلة الشائعة</a></li>
                        <li><a href="/status">حالة النظام</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p class="footer-copy">&copy; @AppInfo.CopyrightYear @AppInfo.Name. جميع الحقوق محفوظة. @AppInfo.VersionDisplay</p>
                <div class="footer-legal">
                    <a href="/privacy">سياسة الخصوصية</a>
                    <a href="/terms">الشروط والأحكام</a>
                    <a href="/admin/login" style="opacity: 0.5;" title="Platform Administration">
                        <i class="bi bi-shield-lock" aria-hidden="true"></i>
                    </a>
                </div>
                <div class="d-flex align-items-center gap-2">
                    <span>Powered by</span>
                    <a href="https://www.doganconsult.com" target="_blank" rel="noopener noreferrer" class="d-flex align-items-center gap-1">
                        <i class="bi bi-lightning-charge-fill text-warning" aria-hidden="true"></i>
                        Dogan Consult
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

    <script>
        // ===== THEME TOGGLE =====
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme') || 'light';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('shahin-theme', newTheme);
        }

        // Load saved theme
        (function() {
            const savedTheme = localStorage.getItem('shahin-theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
        })();

        // ===== MOBILE MENU =====
        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            const toggle = document.querySelector('.mobile-menu-toggle');
            const isOpen = menu.classList.contains('open');

            menu.classList.toggle('open');
            toggle.setAttribute('aria-expanded', !isOpen);
            menu.setAttribute('aria-hidden', isOpen);
            toggle.setAttribute('aria-label', isOpen ? 'فتح القائمة' : 'إغلاق القائمة');

            // Prevent body scroll when menu is open
            document.body.style.overflow = isOpen ? '' : 'hidden';
        }

        // Close mobile menu on escape
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const menu = document.getElementById('mobile-menu');
                if (menu.classList.contains('open')) {
                    toggleMobileMenu();
                }
            }
        });

        // ===== NAVBAR SCROLL EFFECT =====
        window.addEventListener('scroll', function() {
            const navbar = document.querySelector('.landing-navbar');
            if (window.scrollY > 50) {
                navbar.classList.add('scrolled');
            } else {
                navbar.classList.remove('scrolled');
            }
        });

        // ===== FADE-IN ANIMATION ON SCROLL =====
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                }
            });
        }, observerOptions);

        document.querySelectorAll('.fade-in, .fade-up').forEach(el => {
            observer.observe(el);
        });
    </script>

    <!-- AI Chat Widget -->
    <button id="chat-toggle" class="chat-toggle" aria-label="فتح المحادثة مع المساعد الذكي" title="تحدث مع المساعد الذكي">
        <i class="bi bi-robot" aria-hidden="true"></i>
        <span class="chat-badge">AI</span>
    </button>

    <div id="ai-chat-widget" class="ai-chat-widget" role="dialog" aria-label="محادثة مع المساعد الذكي" aria-hidden="true">
        <div class="chat-header">
            <div class="chat-header-info">
                <div class="chat-avatar" aria-hidden="true"><i class="bi bi-robot"></i></div>
                <div>
                    <div class="chat-title">مساعد شاهين الذكي</div>
                    <div class="chat-status">
                        <span class="status-dot" aria-hidden="true"></span>
                        <span>متصل</span>
                    </div>
                </div>
            </div>
            <button id="chat-close" class="chat-close" aria-label="إغلاق المحادثة">
                <i class="bi bi-x-lg" aria-hidden="true"></i>
            </button>
        </div>
        <div id="chat-messages" class="chat-messages" role="log" aria-live="polite" aria-label="رسائل المحادثة">
            <div class="chat-message bot">مرحباً! كيف يمكنني مساعدتك؟</div>
            <div class="chat-suggestions" role="group" aria-label="اقتراحات">
                <button class="suggestion-btn" type="button">ما هي شاهين؟</button>
                <button class="suggestion-btn" type="button">التجربة المجانية</button>
                <button class="suggestion-btn" type="button">الأسعار</button>
            </div>
        </div>
        <div class="chat-input-area">
            <label for="chat-input" class="visually-hidden">اكتب رسالتك</label>
            <input type="text" id="chat-input" placeholder="اكتب رسالتك..." autocomplete="off">
            <button id="chat-send" aria-label="إرسال الرسالة">
                <i class="bi bi-send-fill" aria-hidden="true"></i>
            </button>
        </div>
    </div>

    <script>
        // ===== AI CHAT WIDGET =====
        (function() {
            const chatWidget = document.getElementById('ai-chat-widget');
            const chatToggle = document.getElementById('chat-toggle');
            const chatClose = document.getElementById('chat-close');
            const chatMessages = document.getElementById('chat-messages');
            const chatInput = document.getElementById('chat-input');
            const chatSend = document.getElementById('chat-send');
            const suggestionBtns = document.querySelectorAll('.suggestion-btn');

            if (!chatToggle) return;

            let isOpen = false;

            function openChat() {
                isOpen = true;
                chatWidget.classList.add('open');
                chatWidget.setAttribute('aria-hidden', 'false');
                chatToggle.classList.add('hidden');
                chatInput.focus();
            }

            function closeChat() {
                isOpen = false;
                chatWidget.classList.remove('open');
                chatWidget.setAttribute('aria-hidden', 'true');
                chatToggle.classList.remove('hidden');
                chatToggle.focus();
            }

            chatToggle.addEventListener('click', openChat);
            chatClose.addEventListener('click', closeChat);

            // Close on escape
            chatWidget.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeChat();
                }
            });

            async function sendMessage(message) {
                if (!message.trim()) return;
                addMessage(message, 'user');
                chatInput.value = '';
                const typingId = addTypingIndicator();

                try {
                    const response = await fetch('/api/Landing/ChatMessage', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]')?.value || ''
                        },
                        body: JSON.stringify({ message, context: 'landing_page' })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        removeTypingIndicator(typingId);
                        addMessage(data.response || 'شكراً لتواصلك! سنرد عليك قريباً.', 'bot');
                    } else {
                        throw new Error('API Error');
                    }
                } catch {
                    removeTypingIndicator(typingId);
                    addMessage('مرحباً! للاستفسارات، يرجى التواصل عبر صفحة اتصل بنا.', 'bot');
                }
            }

            function addMessage(text, type) {
                const msg = document.createElement('div');
                msg.className = `chat-message ${type}`;
                msg.textContent = text;
                msg.setAttribute('role', 'article');
                chatMessages.appendChild(msg);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            function addTypingIndicator() {
                const id = 'typing-' + Date.now();
                const indicator = document.createElement('div');
                indicator.id = id;
                indicator.className = 'chat-message bot typing';
                indicator.setAttribute('aria-label', 'جاري الكتابة');
                indicator.innerHTML = '<span class="dot"></span><span class="dot"></span><span class="dot"></span>';
                chatMessages.appendChild(indicator);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                return id;
            }

            function removeTypingIndicator(id) {
                const el = document.getElementById(id);
                if (el) el.remove();
            }

            chatSend.addEventListener('click', () => sendMessage(chatInput.value));
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessage(chatInput.value);
            });
            suggestionBtns.forEach(btn => btn.addEventListener('click', () => sendMessage(btn.textContent)));

            // Pulse animation after 3 seconds
            setTimeout(() => {
                if (!isOpen) chatToggle.classList.add('pulse');
            }, 3000);
        })();
    </script>

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
