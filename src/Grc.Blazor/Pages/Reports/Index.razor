@page "/reports"
@using Grc.Permissions
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize(GrcPermissions.Reports.View)]

<PageTitle>التقارير والتحليلات</PageTitle>

<h3>التقارير والتحليلات</h3>

<div class="row">
    <div class="col-md-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">تقرير الامتثال</h5>
                <p class="card-text">عرض تقرير شامل عن حالة الامتثال</p>
                <AuthorizeView Permission="@GrcPermissions.Reports.Export">
                    <Authorized>
                        <button class="btn btn-primary" @onclick="GenerateComplianceReport">إنشاء التقرير</button>
                    </Authorized>
                </AuthorizeView>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">تقرير المخاطر</h5>
                <p class="card-text">عرض تحليل شامل للمخاطر</p>
                <AuthorizeView Permission="@GrcPermissions.Reports.Export">
                    <Authorized>
                        <button class="btn btn-primary" @onclick="GenerateRiskReport">إنشاء التقرير</button>
                    </Authorized>
                </AuthorizeView>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">تقرير المراجعة</h5>
                <p class="card-text">عرض نتائج المراجعات</p>
                <AuthorizeView Permission="@GrcPermissions.Reports.Export">
                    <Authorized>
                        <button class="btn btn-primary" @onclick="GenerateAuditReport">إنشاء التقرير</button>
                    </Authorized>
                </AuthorizeView>
            </div>
        </div>
    </div>
</div>

@if (isGenerating)
{
    <div class="alert alert-info mt-3">جاري إنشاء التقرير...</div>
}

<ErrorDialog @bind-Error="currentError" />

@code {
    [Inject] private ErrorToastService ErrorToastService { get; set; } = null!;
    
    private bool isGenerating = false;
    private ErrorResponseDto? currentError;

    private async Task GenerateComplianceReport()
    {
        try
        {
            isGenerating = true;
            // TODO: Implement report generation
            await ErrorToastService.ShowSuccessAsync("تم إنشاء تقرير الامتثال بنجاح");
        }
        catch (Exception ex)
        {
            currentError = new ErrorResponseDto { Message = "فشل إنشاء التقرير", Details = ex.Message };
            await ErrorToastService.ShowErrorAsync("فشل الإنشاء", ex.Message);
        }
        finally
        {
            isGenerating = false;
        }
    }

    private async Task GenerateRiskReport()
    {
        try
        {
            isGenerating = true;
            // TODO: Implement report generation
            await ErrorToastService.ShowSuccessAsync("تم إنشاء تقرير المخاطر بنجاح");
        }
        catch (Exception ex)
        {
            currentError = new ErrorResponseDto { Message = "فشل إنشاء التقرير", Details = ex.Message };
            await ErrorToastService.ShowErrorAsync("فشل الإنشاء", ex.Message);
        }
        finally
        {
            isGenerating = false;
        }
    }

    private async Task GenerateAuditReport()
    {
        try
        {
            isGenerating = true;
            // TODO: Implement report generation
            await ErrorToastService.ShowSuccessAsync("تم إنشاء تقرير المراجعة بنجاح");
        }
        catch (Exception ex)
        {
            currentError = new ErrorResponseDto { Message = "فشل إنشاء التقرير", Details = ex.Message };
            await ErrorToastService.ShowErrorAsync("فشل الإنشاء", ex.Message);
        }
        finally
        {
            isGenerating = false;
        }
    }
}
