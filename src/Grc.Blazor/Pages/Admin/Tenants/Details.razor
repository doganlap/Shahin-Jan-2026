@page "/admin/tenants/{Id:guid}"
@using Grc.Application.Contracts.Admin.TenantManagement
@attribute [Authorize(Grc.Permissions.GrcPermissions.Admin.Tenants)]

<PageTitle>تفاصيل العميل</PageTitle>

<h3>تفاصيل العميل</h3>

@if (loading)
{
    <p>جاري التحميل...</p>
}
else if (tenant != null)
{
    <div class="card">
        <div class="card-body">
            <dl class="row">
                <dt class="col-sm-3">اسم العميل</dt>
                <dd class="col-sm-9">@tenant.Name</dd>

                <dt class="col-sm-3">الحالة</dt>
                <dd class="col-sm-9">
                    @if (tenant.IsActive)
                    {
                        <span class="badge bg-success">نشط</span>
                    }
                    else
                    {
                        <span class="badge bg-secondary">غير نشط</span>
                    }
                </dd>

                <dt class="col-sm-3">تاريخ الإنشاء</dt>
                <dd class="col-sm-9">@tenant.CreationTime?.ToString("yyyy-MM-dd HH:mm")</dd>

                <dt class="col-sm-3">تاريخ الانتهاء</dt>
                <dd class="col-sm-9">@(tenant.ExpirationDate?.ToString("yyyy-MM-dd") ?? "-")</dd>

                <dt class="col-sm-3">عدد المستخدمين</dt>
                <dd class="col-sm-9">@tenant.UserCount</dd>
            </dl>

            <div class="mt-3">
                <a href="/admin/tenants" class="btn btn-secondary">رجوع</a>
            </div>
        </div>
    </div>
}

@code {
    [Parameter]
    public Guid Id { get; set; }

    private TenantDto? tenant;
    private bool loading = true;

    [Inject]
    private ITenantManagementAppService TenantManagementAppService { get; set; } = null!;

    protected override async Task OnInitializedAsync()
    {
        await LoadTenant();
    }

    private async Task LoadTenant()
    {
        loading = true;
        try
        {
            tenant = await TenantManagementAppService.GetDetailsAsync(Id);
        }
        catch (Exception ex)
        {
            // TODO: Handle error properly
            Console.WriteLine($"Error loading tenant: {ex.Message}");
        }
        finally
        {
            loading = false;
        }
    }
}
